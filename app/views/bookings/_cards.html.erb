<div class="bg-gradient-to-br from-gray-800 via-gray-800 to-gray-800 border border-gray-700 rounded-2xl shadow-lg overflow-hidden transform hover:scale-[1.02] hover:shadow-2xl transition-all duration-300 text-sm text-gray-200">

  <div class="relative group">
    <% if booking.vehicle.image.attached? %>
      <div class="overflow-hidden relative">
        <%= image_tag booking.vehicle.image, class: "w-full h-44 object-cover transition-transform duration-500 group-hover:scale-105 border-b border-gray-700" %>
        <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent opacity-70 group-hover:opacity-80 transition-opacity duration-300 rounded-t-2xl"></div>
      </div>
    <% else %>
      <div class="w-full h-44 bg-gray-500 flex items-center justify-center text-gray-400 text-sm border-b border-gray-700 rounded-t-2xl">
        ğŸš˜ No Image Available
      </div>
    <% end %>

    <div class="absolute inset-0 rounded-t-2xl ring-1 ring-blue-400/10 group-hover:ring-blue-400/40 group-hover:shadow-[0_0_25px_rgba(56,189,248,0.3)] transition-all duration-500"></div>
  </div>

  <div class="p-5 flex flex-col flex-1 space-y-2">

    <div class="flex flex-wrap gap-2 mb-2">
      <span class="inline-block bg-gray-500/60 px-3 py-1 rounded-full text-gray-300 border border-gray-700">
        ğŸš© <strong>From:</strong> <%= booking.start_location.humanize %>
      </span>
      <span class="inline-block bg-gray-500/60 px-3 py-1 rounded-full text-gray-300 border border-gray-700">
        ğŸ <strong>To:</strong> <%= booking.end_location.humanize %>
      </span>
    </div>

    <p><strong class="text-gray-100">ğŸš˜ Vehicle:</strong> <%= booking.vehicle.model %></p>
    <p><strong class="text-gray-100">ğŸ•“ Start:</strong> <%= booking.start_time.strftime("%d %b %Y, %I:%M %p") %></p>
    <p><strong class="text-gray-100">ğŸ‘¨â€âœˆï¸ Driver:</strong> <%= booking.driver.user.name %></p>
    <p><strong class="text-gray-100">ğŸ’° Price:</strong> â‚¹<%= booking.price %></p>

    <% if booking.cancelled_by.present? %>
      <span class="mt-2 inline-block bg-red-800/40 border border-red-500 text-red-400 font-semibold px-3 py-1 rounded-full">
        âŒ Cancelled by <%= booking.cancelled_by.capitalize %>
        <span class="text-xs block opacity-80">[<%= booking.cancelled_at.in_time_zone.strftime("%d %b %Y, %I:%M %p") %>]</span>
      </span>
    <% elsif booking.status %>
      <span class="mt-2 inline-block bg-green-800/40 border border-green-500 text-green-300 font-semibold px-3 py-1 rounded-full">
        âœ… Driver accepted the ride.
      </span>
    <% elsif booking.customer_accepted? %>
      <span class="mt-2 inline-block bg-yellow-800/40 border border-yellow-500 text-yellow-300 font-semibold px-3 py-1 rounded-full">
        âš¡ You accepted the price. Waiting for driver confirmation.
      </span>
    <% else %>
      <span class="mt-2 inline-block bg-blue-800/40 border border-blue-500 text-blue-300 font-semibold px-3 py-1 rounded-full">
        ğŸ”µ Active
      </span>
    <% end %>

    <!-- Buttons and Actions -->
    <% unless booking.cancelled_by.present? %>
      <% if booking.proposed_price.present? && !booking.customer_accepted? %>
        <p class="mt-3 text-yellow-300 font-semibold">
          ğŸ’¬ Driver Proposed Price: â‚¹<%= booking.proposed_price %>
        </p>
        <%= button_to "Accept Proposed Price", accept_price_booking_path(booking), method: :patch,
            class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-2 mt-2 rounded-lg shadow-md transition-all duration-200" %>
      <% elsif booking.status %>
        <% if booking.payment.blank? && Time.current >= booking.start_time %>
          <%= link_to "Make Payment", new_payment_path(booking_id: booking.id),
              class: "inline-block bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 mt-2 rounded-lg shadow-md transition-all duration-200" %>
        <% end %>
      <% end %>

      <% if Time.current < booking.start_time.in_time_zone - 30.minutes %>
        <%= button_to "Cancel", booking_path(booking), method: :delete,
          form: { onsubmit: "return confirm('Are you sure you want to cancel this ride?');" },
          class: "bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded-lg mt-2 transition-all duration-200 shadow-md" %>
      <% elsif !booking.status %>
        <%= button_to "Cancel", booking_path(booking), method: :delete,
          form: { onsubmit: "return confirm('Are you sure you want to cancel this ride?');" },
          class: "bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded-lg mt-2 transition-all duration-200 shadow-md" %>
      <% end %>

      <% if booking.payment&.payment_status %>
        <p class="text-green-400 font-semibold italic mt-2">âœ… Payment Done!</p>
      <% end %>

      <% if defined?(show_countdown) && show_countdown && booking.status && Time.current < booking.start_time.in_time_zone && booking.payment.blank? %>
        <div class="mt-3 bg-blue-900/30 border border-blue-500/30 rounded-lg p-2 text-center">
          <p id="countdown-<%= booking.id %>" class="text-blue-300 font-semibold italic">ğŸ•’ Starts soon...</p>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", function () {
            const countdownEl = document.getElementById("countdown-<%= booking.id %>");
            const rideStartTime = new Date("<%= booking.start_time.in_time_zone.iso8601 %>").getTime();

            function updateCountdown() {
              const now = new Date().getTime();
              const distance = rideStartTime - now;

              if (distance <= 0) {
                countdownEl.innerText = "ğŸš˜ Ride started!";
                return;
              }

              const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
              const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
              const seconds = Math.floor((distance % (1000 * 60)) / 1000);
              countdownEl.innerText = `Starts in ${hours}h ${minutes}m ${seconds}s`;
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
          });
        </script>
      <% end %>
    <% end %>
  </div>
</div>
